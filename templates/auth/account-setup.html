<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .PageTitle }}</title>
    <link rel="stylesheet" href="/static/css/themes/{{ .Theme.AdminTheme }}.css" data-theme-css>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/auth.css">
    {{ if .Theme.CustomCSSURL }}<link rel="stylesheet" href="{{ .Theme.CustomCSSURL }}">{{ end }}
    {{ if .Theme.InlineCSS }}<style>{{ .Theme.InlineCSSTemplate }}</style>{{ end }}
</head>
<body data-theme="{{ .Theme.AdminTheme }}">
    <div class="card {{ if .IsAdmin }}large{{ else }}medium{{ end }} setup-card">
        <div class="setup-header">
            <h1>{{ .PageHeading }}</h1>
            <p class="setup-subtitle">{{ .PageSubheading }}</p>
            {{ if .IsAdmin }}<p class="lead">Pin requires 2FA. You will need an authenticator app to finish setup.</p>{{ end }}
        </div>
        {{ if .Error }}
        <div class="error">{{ .Error }}</div>
        {{ end }}
        {{ if .Success }}
        <div class="message">{{ .SuccessMessage }}</div>
        {{ if .TOTPURL }}
        <div class="two-col totp-setup" data-qr="{{ .TOTPURL }}">
            <div>
                <p class="meta"><strong>Scan the QR code</strong></p>
                <img class="qr" src="" alt="Authenticator QR code">
                <p class="meta">Open your authenticator app and scan this code.</p>
            </div>
            <div>
                <p class="meta"><strong>Or enter this secret manually</strong></p>
                <div class="copy-pill">
                    <span class="inline-code">{{ .TOTP }}</span>
                    <button type="button" class="icon-button copy-button" data-copy-value="{{ .TOTP }}" data-copy-feedback="Copied" aria-label="Copy token">
                        <span class="icon icon-copy" aria-hidden="true"></span>
                    </button>
                </div>
                <p class="meta">Save this secret somewhere safe. You will need it to recover access.</p>
            </div>
        </div>
        {{ if .IsAdmin }}
        <p class="lead">Next steps</p>
        <ol class="setup-steps">
            <li>Open your authenticator app and add a new account.</li>
            <li>Scan the QR code or enter the secret manually.</li>
            <li>Log in with your handle, password, and the 6-digit code generated by your authenticator app.</li>
        </ol>
        {{ end }}
        {{ end }}
        <p class="setup-actions"><a href="/login">Go to login</a></p>
        {{ else }}
        {{ if .FormIntro }}<p class="lead">{{ .FormIntro }}</p>{{ end }}
        <form class="setup-form" method="post" action="{{ .FormAction }}">
            <input type="hidden" name="csrf_token" value="{{ .CSRFToken }}">
            <label for="handle">Handle</label>
            <input type="text" id="handle" name="handle" required>

            <label for="password">Password</label>
            <input type="password" id="password" name="password" required>

            <button type="submit">{{ .FormButtonLabel }}</button>
        </form>
        {{ end }}
    </div>
    <script src="/static/js/qrcode.min.js"></script>
    <script src="/static/js/qr.js"></script>
    <script src="/static/js/settings-copy.js"></script>
</body>
</html>
