<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pin - Setup Admin</title>
    <link rel="stylesheet" href="/static/css/style.css">
    {{ if .Theme.CustomCSSURL }}<link rel="stylesheet" href="{{ .Theme.CustomCSSURL }}">{{ end }}
    {{ if .Theme.InlineCSS }}<style>{{ .Theme.InlineCSSTemplate }}</style>{{ end }}
</head>
<body data-theme="{{ .Theme.AdminTheme }}">
    <div class="card large setup-card">
        <div class="setup-header">
            <h1>Set up your admin account</h1>
            <p class="setup-subtitle">Create the first owner account for this Pin instance.</p>
            <p class="lead">Pin requires 2FA. You will need an authenticator app to finish setup.</p>
        </div>
        {{ if .Error }}
        <div class="error">{{ .Error }}</div>
        {{ end }}
        {{ if .Success }}
        <div class="message">Account created. Set up your authenticator app to finish.</div>
        <div class="two-col totp-setup" data-qr="{{ .TOTPURL }}">
            <div>
                <p class="meta"><strong>Scan the QR code</strong></p>
                <img class="qr" src="" alt="Authenticator QR code">
                <p class="meta">Open your authenticator app and scan this code.</p>
            </div>
            <div>
                <p class="meta"><strong>Or enter this secret manually</strong></p>
                <div class="copy-pill">
                    <span class="inline-code">{{ .TOTP }}</span>
                    <button type="button" class="icon-button copy-button" data-copy-value="{{ .TOTP }}" data-copy-feedback="Copied" aria-label="Copy token">
                        <span class="icon icon-copy" aria-hidden="true"></span>
                    </button>
                </div>
                <p class="meta">Save this secret somewhere safe. You will need it to recover access.</p>
            </div>
        </div>
        <p class="lead">Next steps</p>
        <ol class="setup-steps">
            <li>Open your authenticator app and add a new account.</li>
            <li>Scan the QR code or enter the secret manually.</li>
            <li>Log in with your username, password, and the 6-digit code generated by your authenticator app.</li>
        </ol>
        <p class="setup-actions"><a href="/login">Go to login</a></p>
        {{ else }}
        <p class="lead">You can change these details later in settings.</p>
        <form class="setup-form" method="post" action="/setup">
            <input type="hidden" name="csrf_token" value="{{ .CSRFToken }}">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" required>

            <label for="password">Password</label>
            <input type="password" id="password" name="password" required>

            <button type="submit">Create admin</button>
        </form>
        {{ end }}
    </div>
    <script>
        (function () {
            const qrPanel = document.querySelector('.totp-setup');
            if (!qrPanel) return;
            const qrImg = qrPanel.querySelector('.qr');
            const data = qrPanel.getAttribute('data-qr');
            if (!qrImg || !data) return;
            const qrUrl = '/qr?data=' + encodeURIComponent(data);
            qrImg.src = qrUrl;
        })();
    </script>
    <script src="/static/js/settings-copy.js"></script>
</body>
</html>
